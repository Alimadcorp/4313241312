<!doctype html>

<html lang="en">
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width,initial-scale=1">
 <title>ChatApp — Numeric</title>
 <style>
  @font-face {
   font-family:NumFont;src:url('https://corsproxy.io/?url=https://cdn.alimad.co/f/static/TestRadioUnary.woff2') format('woff2');font-display:swap
  }
:root {
   --bg: #000;
   --panel: #021006;
   --accent: #38ff77;
   --muted: #4a6b52;
   --border: #072312
  }
  * {
   box-sizing: border-box;
   font-family: NumFont,monospace;
   color: #38ff77;
  }
  html,body {
   margin: 0;
   height: 100%;
   background: var(--bg)
  }
  .app {
   max-width: 880px;
   margin: 0 auto;
   height: 100vh;
   display: flex;
   flex-direction: column;
   border: 2px solid var(--border);
   border-radius: 4px;
   overflow: hidden;
   background: var(--panel);
   box-shadow: 0 0 30px #000
  }
  .header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: 20px;
   border-bottom: 2px solid var(--border);
   font-size: 48px
  }
  .messages {
   flex: 1;
   overflow: auto;
   padding: 3px;
   display: flex;
   flex-direction: column;
   gap: 2px;
   scroll-behavior: smooth
  }
  .msg {
   max-width: 90%;
   padding: 3px 5px;
   border: 2px solid var(--border);
   border-radius: 12px;
   background: rgba(0,0,0,0.3);
   font-size: 42px;
  }
  .msg.me {
   margin-left: auto;
   border-color: var(--accent)
  }
  .msg.system {
   align-self: center;
   border: none;
   color: #6af2ff
  }
  .meta {
   font-size: 24px;
   color: var(--muted);
   margin-bottom: 8px
  }
  .footer {
   display: flex;
   gap: 5px;
   padding: 10px;
   border-top: 2px solid var(--border)
  }
  .input,.btn {
   border: 2px solid var(--border);
   border-radius: 10px;
   background: rgba(0,0,0,0.3);
   padding: 8px;
   font-size: 38px;
   color: #38ff77;
   outline: none
  }
  .input {
   flex: 1
  }
  .btn {
   cursor: pointer;
   font-weight: 700
  }
  .modal {
   position: fixed;
   inset: 0;
   background: rgba(0,0,0,0.9);
   display: flex;
   align-items: center;
   justify-content: center
  }
  .card {
   background: var(--panel);
   border: 3px solid var(--border);
   border-radius: 16px;
   padding: 40px;
   display: flex;
   flex-direction: column;
   gap: 20px;
   align-items: center;
   box-shadow: 0 0 40px #000
  }
  .card input {
   font-size: 36px;
   padding: 16px;
   width: 100%;
   border: 2px solid var(--border);
   background: rgba(0,0,0,0.3);
   color: #38ff77;
   border-radius: 10px
  }
  .card button {
   font-size: 36px;
   padding: 16px 40px;
   background: rgba(0,0,0,0.3);
   border: 2px solid var(--border);
   color: #38ff77;
   border-radius: 10px;
   cursor: pointer
  }
  * {
   line-height: 20px;
   word-wrap: break-word;
  }
 </style>
</head>
<body>
 <div class="app">
  <div class="header">
   <div>
    4313214312
   </div>
   <div id="currentUser"></div>
  </div>
  <div class="messages" id="messages"></div>
  <div class="footer">
   <input id="mail" class="input" placeholder="312612345"><button id="send" class="btn">341552121</button>
  </div>
 </div>
 <div class="modal" id="modal" style="display:none">
  <div class="card">
   <div>
    155231215260316415265241545
   </div>
   <input id="usernameInput" placeholder="111"><button id="startBtn">53212</button>
  </div>
 </div>
 <script>
  const c = {
   111: "A",
   112: "B",
   113: "C",
   121: "D",
   122: "E",
   123: "F",
   131: "G",
   132: "H",
   133: "I",
   211: "J",
   212: "K",
   213: "L",
   221: "M",
   222: "N",
   223: "O",
   231: "P",
   232: "Q",
   233: "R",
   311: "S",
   312: "T",
   313: "U",
   321: "V",
   322: "W",
   323: "X",
   331: "Y",
   332: "Z",
   333: "*",
   0: " ",
   117: ".",
   227: "?",
   337: "!",
   127: ",",
   217: "-",
   237: ";",
   317: ":",
   711: "@",
   712: "#",
   713: "/",
   721: "%",
   722: "¤",
   723: "\\",
   171: "'",
   272: '"',
   373: "(",
   811: "+",
   812: "_",
   813: "*",
   821: "÷",
   822: "=",
   823: "^",
   118: "0",
   181: "1",
   182: "2",
   183: "3",
   281: "4",
   282: "5",
   283: "6",
   381: "7",
   382: "8",
   383: "9",
  };

  let cipher = c;

  const API_BASE = 'https://log.alimad.co', CHANNEL = '4313214312', POLL_INTERVAL = 3000;
  const msgEl = document.getElementById('messages'), mail = document.getElementById('mail'), send = document.getElementById('send'), userEl = document.getElementById('currentUser'), modal = document.getElementById('modal'), userInput = document.getElementById('usernameInput'), start = document.getElementById('startBtn');
  let inverseCipher = {};
  console.log(cipher)
  inverseCipher = Object.fromEntries(Object.entries(cipher).map(([k, v])=>[v, k]));
  console.log(inverseCipher)
  function encrypt(t) {
   let o = ""; for (const ch of t.toUpperCase()) {
    const token = inverseCipher[ch]; if (!token) {
     o += "791"+ch.charCodeAt(0)+"791"; continue;
    }o += token
   }return o.replace(/11/g, "4").replace(/22/g, "5").replace(/33/g, "6")}
  console.log(encrypt("test"))
  function renderLog(log) {
   const el = document.createElement('div'); el.className = 'msg'; if (log.status === 'system') {
    el.classList.add('system'); el.textContent = (log.text); msgEl.appendChild(el); return;
   }const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = ((log.user || '')+' '+(log.time || '')); el.appendChild(meta); const body = document.createElement('div'); body.textContent = (log.text); el.appendChild(body); if ((log.user || '').toLowerCase() === localStorage.getItem('chatapp_username')?.toLowerCase())el.classList.add('me'); msgEl.appendChild(el);
  }
  let l = [];
  async function poll() {
   try {
    const r = await fetch(`${API_BASE}/api/pull?channel=${CHANNEL}&_=${Date.now()}`); if (!r.ok)throw 0; const j = await r.json(); if (Array.isArray(j.logs)) {
     if (JSON.stringify(l) != JSON.stringify(j.logs)) {
      l = j.logs;
      msgEl.innerHTML = ''; j.logs.forEach(renderLog); msgEl.scrollTop = msgEl.scrollHeight;
     }
    }}catch(e) {}}
  async function post(text, status = 'user') {
   try {
    await fetch(`${API_BASE}/api/log?channel=${CHANNEL}&text=${encodeURIComponent(text)}&status=${status}&user=${encodeURIComponent(localStorage.getItem('chatapp_username') || '')}`)}catch(e) {}}
  mail.addEventListener('input', e => {
   const v = e.target.value;
   const last = v.slice(-1);
   if (!last.match(/[\w\d]/)) return; // ignore control/non-data chars
   e.target.value = v.slice(0, -1) + encrypt(last);
  });

  mail.addEventListener('paste', e => {
   e.preventDefault();
   const text = (e.clipboardData || window.clipboardData).getData('text');
   mail.value += encrypt(text);
  });
  send.addEventListener('click', async()=> {
   const t = mail.value.trim(); if (!t)return; await post(t, 'user'); mail.value = ''
  });
  mail.addEventListener('keydown', e=> {
   if (e.key === 'Enter') {
    e.preventDefault(); send.click()}});
  function openModal() {
   const u = localStorage.getItem('chatapp_username'); if (!u)modal.style.display = 'flex'; else {
    userEl.textContent = encrypt(u); modal.style.display = 'none'; post(encrypt(u+' joined'), 'system')}}
  start.addEventListener('click', ()=> {
   const v = userInput.value.trim(); if (!v)return; localStorage.setItem('chatapp_username', v); userEl.textContent = encrypt(v); modal.style.display = 'none'; post(encrypt(v+' joined'), 'system')});
  window.addEventListener('beforeunload', ()=> {
   const u = localStorage.getItem('chatapp_username') || 'unknown'; const url = `${API_BASE}/api/log?channel=${CHANNEL}&text=${encodeURIComponent(encrypt(u+' left'))}&status=system&user=${encodeURIComponent(u)}`; if (navigator.sendBeacon)navigator.sendBeacon(url); else fetch(url)});
  openModal(); poll(); setInterval(poll, POLL_INTERVAL);
 </script>
</body>
  </html>
